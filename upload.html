
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload Image</title>
  <script type="module" src="firebase-config.js"></script>
  <script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
    import { app } from "./firebase-config.js";

    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "index.html";
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("uploadForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const file = document.getElementById("imageFile").files[0];
        const caption = document.getElementById("caption").value;

        if (!file) return alert("Please select an image.");
        const storageRef = ref(storage, "pending/" + file.name);
        await uploadBytes(storageRef, file);
        const url = await getDownloadURL(storageRef);

        await addDoc(collection(db, "pendingImages"), {
          url,
          caption,
          createdAt: serverTimestamp(),
          uploader: auth.currentUser.email
        });

        alert("Image uploaded for review.");
        document.getElementById("uploadForm").reset();
      });
    });
  </script>
</head>
<body style="padding:20px; font-family:sans-serif;">
  <h2>Upload Your Photo</h2>
  <form id="uploadForm">
    <input type="file" id="imageFile" accept="image/*" required /><br><br>
    <textarea id="caption" placeholder="Enter your quote or message..." required></textarea><br><br>
    <button type="submit">Submit for Review</button>
  </form>
</body>
</html>
